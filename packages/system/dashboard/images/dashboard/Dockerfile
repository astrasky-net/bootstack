# Copyright 2018-2023 the Kubeapps contributors.
# SPDX-License-Identifier: Apache-2.0

FROM bitnami/node:20.12.1 AS build
WORKDIR /app

ARG VERSION=2.10.0
RUN wget -O- https://github.com/vmware-tanzu/kubeapps/archive/refs/tags/v${VERSION}.tar.gz | tar xzf - --strip-components=2 kubeapps-${VERSION}/dashboard

COPY apple-touch-icon.png favicon-16x16.png favicon-32x32.png favicon.ico mstile-144x144.png mstile-150x150.png mstile-310x150.png mstile-310x310.png mstile-70x70.png safari-pinned-tab.svg public/

RUN sed -i 's/opacity: 0.05;/display: none;/g' src/components/InfoCard/InfoCard.scss
RUN sed -i 's/"Kubeapps",/"Bootstack",/' lang/en.json
RUN sed -i 's/Kubeapps/Bootstack/g' public/site.webmanifest
RUN sed -i 's/Welcome To Kubeapps/Welcome To Bootstack/g' ./src/components/LoginForm/LoginForm.tsx ./src/components/AppList/AppListGrid.tsx ./src/components/AppList/AppList.test.tsx
RUN sed -i src/components/DeploymentForm/DeploymentForm.tsx \
 -e '/const handleDeploy/i \  const packageName = packageId ? packageId.split("/").pop() : "";' \
 -e '/releaseName,$/ s|releaseName,|packageName + "-" + releaseName,|' 
RUN sed -i '/by VMware/,/ \.$/d' src/components/Header/Menu.tsx
RUN sed -i '/height: 4em;/ s/4em/5.5em/' src/components/Header/Header.scss
RUN sed -i '/background-image/ s|base64,[^"]\+|base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgCiAgICB3aWR0aD0iNTIxIiAKICAgIGhlaWdodD0iMTg1IiAKICAgIHZpZXdCb3g9IjAgMCA1MjEgMTg1IiAKICAgIGZpbGw9Im5vbmUiIAogICAgdmVyc2lvbj0iMS4xIiAKICAgIGlkPSJzdmc5NTgiCiAgICBzb2RpcG9kaTpkb2NuYW1lPSJBU1RSQVNUQUNLLnN2ZyIgCiAgICBpbmtzY2FwZTp2ZXJzaW9uPSIxLjEuMSAoYzMwODRlZiwgMjAyMS0wOS0yMikiCiAgICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8ZGVmcyAKICAgICAgIGlkPSJkZWZzOTYyIiAvPgogICAgPHNvZGlwb2RpOm5hbWVkdmlldyAKICAgICAgIGlkPSJuYW1lZHZpZXc5NjAiIAogICAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIiAKICAgICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IiAKICAgICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiIAogICAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIgCiAgICAgICBpbmtzY2FwZTpwYWdlY2hlY2tlcmJvYXJkPSIwIiAKICAgICAgIHNob3dncmlkPSJmYWxzZSIKICAgICAgIHNob3dndWlkZXM9InRydWUiIAogICAgICAgaW5rc2NhcGU6Z3VpZGUtYmJveD0idHJ1ZSIgCiAgICAgICBpbmtzY2FwZTp6b29tPSIwLjU2NjEwNjA5IiAKICAgICAgIGlua3NjYXBlOmN4PSIxNTEuMDMxNzYiCiAgICAgICBpbmtzY2FwZTpjeT0iMzE3LjA3ODM3IiAKICAgICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTI5NiIgCiAgICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5NjkiIAogICAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMjUiIAogICAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIgCiAgICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc5NTgiIC8+CiAgICA8cGF0aAogICAgICAgIGQ9Ik0yMy4zODMzIDExOEgxOS4yODE3TDQyLjk3NTYgNjUuNjMxOEg0Ny41NTMyTDcxLjM1NjkgMTE4SDY2Ljc3OTNMNTkuMDE1NiAxMDAuNDIySDM1LjU0MTVMMzYuNjc2OCA5Ny4xMjZINTcuNTg3NEw0NS4wMjY0IDY4LjYzNDhMMjMuMzgzMyAxMThaIgogICAgICAgIGZpbGw9IndoaXRlIiAvPgogICAgPHBhdGgKICAgICAgICBkPSJNNzguMTMxOCAxMTYuMTY5VjExMi4xNDFDODMuNjI1IDExNC4wOTQgODkuNjc5NyAxMTUuMDcgOTYuMjk1OSAxMTUuMDdDMTA3LjI1OCAxMTUuMDcgMTEyLjczOSAxMTAuOTIgMTEyLjczOSAxMDIuNjE5QzExMi43MzkgOTYuNTE1NiAxMDkuMTc0IDkzLjQ2MzkgMTAyLjA0NSA5My40NjM5SDkxLjI3ODhDODEuNTM3NiA5My40NjM5IDc2LjY2NyA4OS4wNjkzIDc2LjY2NyA4MC4yODAzQzc2LjY2NyA3MC4yNzA1IDgzLjgwODEgNjUuMjY1NiA5OC4wOTAzIDY1LjI2NTZDMTAzLjk1IDY1LjI2NTYgMTA5LjYyNiA2NS45OTggMTE1LjExOSA2Ny40NjI5VjcxLjEyNUMxMDkuNjI2IDY5LjQxNiAxMDMuOTUgNjguNTYxNSA5OC4wOTAzIDY4LjU2MTVDODYuMzcxNiA2OC41NjE1IDgwLjUxMjIgNzIuNDY3OCA4MC41MTIyIDgwLjI4MDNDODAuNTEyMiA4Ni42Mjc5IDg0LjEwMTEgODkuODAxOCA5MS4yNzg4IDg5LjgwMThIMTAyLjA0NUMxMTEuNzM4IDg5LjgwMTggMTE2LjU4NCA5NC4wNzQyIDExNi41ODQgMTAyLjYxOUMxMTYuNTg0IDExMy4xMTcgMTA5LjgyMSAxMTguMzY2IDk2LjI5NTkgMTE4LjM2NkM4OS42Nzk3IDExOC4zNjYgODMuNjI1IDExNy42MzQgNzguMTMxOCAxMTYuMTY5WiIKICAgICAgICBmaWxsPSJ3aGl0ZSIgLz4KICAgIDxwYXRoIAoJZD0iTTE2MC4zNDYgNjUuNjMxOFY2OC45Mjc3SDE0Mi40MDJWMTE4SDEzOC41NTdWNjguOTI3N0gxMjAuOTc5VjY1LjYzMThIMTYwLjM0NloiIAoJZmlsbD0id2hpdGUiIC8+CiAgICA8cGF0aAogICAgICAgIGQ9Ik0xNjYuNjA4IDExOFY2NS42MzE4SDE4OC4yMTVDMTk3LjY4OCA2NS42MzE4IDIwMi40MjQgNjkuODE4OCAyMDIuNDI0IDc4LjE5MjlDMjAyLjQyNCA4NS40NDM4IDE5Ny4yODUgOTAuNTgzIDE4Ny4wMDYgOTMuNjEwNEwyMDQuNjk0IDExOEgxOTkuNDIxTDE4Mi4wMjYgOTMuNzIwMlY5MS4xMjAxQzE5Mi43NjggODkuNTMzMiAxOTguMTM5IDg1LjMyMTggMTk4LjEzOSA3OC40ODU4QzE5OC4xMzkgNzIuMTg3IDE5NC42MjQgNjkuMDM3NiAxODcuNTkyIDY5LjAzNzZIMTcwLjQ1NFYxMThIMTY2LjYwOFoiCiAgICAgICAgZmlsbD0id2hpdGUiIC8+CiAgICA8cGF0aAogICAgICAgIGQ9Ik0yMTEuMzk2IDExOEgyMDcuMjk0TDIzMC45ODggNjUuNjMxOEgyMzUuNTY2TDI1OS4zNyAxMThIMjU0Ljc5MkwyNDcuMDI4IDEwMC40MjJIMjIzLjU1NEwyMjQuNjg5IDk3LjEyNkgyNDUuNkwyMzMuMDM5IDY4LjYzNDhMMjExLjM5NiAxMThaIgogICAgICAgIGZpbGw9IndoaXRlIiAvPgogICAgPHBhdGgKICAgICAgICBkPSJNMjY2LjE0NSAxMTYuMTY5VjExMi4xNDFDMjcxLjYzOCAxMTQuMDk0IDI3Ny42OTIgMTE1LjA3IDI4NC4zMDkgMTE1LjA3QzI5NS4yNzEgMTE1LjA3IDMwMC43NTEgMTEwLjkyIDMwMC43NTEgMTAyLjYxOUMzMDAuNzUxIDk2LjUxNTYgMjk3LjE4NyA5My40NjM5IDI5MC4wNTggOTMuNDYzOUgyNzkuMjkyQzI2OS41NSA5My40NjM5IDI2NC42OCA4OS4wNjkzIDI2NC42OCA4MC4yODAzQzI2NC42OCA3MC4yNzA1IDI3MS44MjEgNjUuMjY1NiAyODYuMTAzIDY1LjI2NTZDMjkxLjk2MiA2NS4yNjU2IDI5Ny42MzkgNjUuOTk4IDMwMy4xMzIgNjcuNDYyOVY3MS4xMjVDMjk3LjYzOSA2OS40MTYgMjkxLjk2MiA2OC41NjE1IDI4Ni4xMDMgNjguNTYxNUMyNzQuMzg0IDY4LjU2MTUgMjY4LjUyNSA3Mi40Njc4IDI2OC41MjUgODAuMjgwM0MyNjguNTI1IDg2LjYyNzkgMjcyLjExNCA4OS44MDE4IDI3OS4yOTIgODkuODAxOEgyOTAuMDU4QzI5OS43NSA4OS44MDE4IDMwNC41OTcgOTQuMDc0MiAzMDQuNTk3IDEwMi42MTlDMzA0LjU5NyAxMTMuMTE3IDI5Ny44MzQgMTE4LjM2NiAyODQuMzA5IDExOC4zNjZDMjc3LjY5MiAxMTguMzY2IDI3MS42MzggMTE3LjYzNCAyNjYuMTQ1IDExNi4xNjlaIgogICAgICAgIGZpbGw9IndoaXRlIiAvPgogICAgPHBhdGggCglkPSJNMzQ4LjM1OSA2NS42MzE4VjY4LjkyNzdIMzMwLjQxNVYxMThIMzI2LjU2OVY2OC45Mjc3SDMwOC45OTFWNjUuNjMxOEgzNDguMzU5WiIgCglmaWxsPSJ3aGl0ZSIgLz4KICAgIDxwYXRoCiAgICAgICAgZD0iTTM1NC4xNDUgMTE4SDM1MC4wNDNMMzczLjczNyA2NS42MzE4SDM3OC4zMTVMNDAyLjExOSAxMThIMzk3LjU0MUwzODkuNzc3IDEwMC40MjJIMzY2LjMwM0wzNjcuNDM4IDk3LjEyNkgzODguMzQ5TDM3NS43ODggNjguNjM0OEwzNTQuMTQ1IDExOFoiCiAgICAgICAgZmlsbD0id2hpdGUiIC8+CiAgICA8cGF0aAogICAgICAgIGQ9Ik00NDkuNTQzIDExNi4xNjlDNDQ0Ljc4MiAxMTcuNjM0IDQzOS44OTkgMTE4LjM2NiA0MzQuODk1IDExOC4zNjZDNDE2LjU4NCAxMTguMzY2IDQwNy40MjkgMTA5LjI3MiA0MDcuNDI5IDkxLjA4MzVDNDA3LjQyOSA3My44NzE2IDQxNi41ODQgNjUuMjY1NiA0MzQuODk1IDY1LjI2NTZDNDM5Ljg5OSA2NS4yNjU2IDQ0NC43ODIgNjUuOTk4IDQ0OS41NDMgNjcuNDYyOVY3MC43NTg4QzQ0NC43ODIgNjkuMjkzOSA0NDAuMTQ0IDY4LjU2MTUgNDM1LjYyNyA2OC41NjE1QzQxOS4zOTIgNjguNTYxNSA0MTEuMjc0IDc2LjA2ODggNDExLjI3NCA5MS4wODM1QzQxMS4yNzQgMTA3LjA3NSA0MTkuMzkyIDExNS4wNyA0MzUuNjI3IDExNS4wN0M0NDAuMTQ0IDExNS4wNyA0NDQuNzgyIDExNC4zMzggNDQ5LjU0MyAxMTIuODczVjExNi4xNjlaIgogICAgICAgIGZpbGw9IndoaXRlIiAvPgogICAgPHBhdGgKICAgICAgICBkPSJNNDY0LjU5NCA2NS42MzE4VjExOEg0NjAuNzQ5VjY1LjYzMThINDY0LjU5NFpNNTAwLjUyIDY1LjYzMThMNDc1LjU4MSA5MC40MjQzTDUwMS4zOTggMTE4SDQ5NS42NDlMNDcxLjczNSA5MS43MDYxVjg5LjQzNTVMNDk1LjI0NiA2NS42MzE4SDUwMC41MloiCiAgICAgICAgZmlsbD0id2hpdGUiIC8+Cjwvc3ZnPg==|' src/components/Header/Header.scss
RUN sed -i '/background-image/a \  background-size: 85%;' src/components/Header/Header.scss

RUN yarn install --frozen-lockfile

RUN yarn run prettier-check && yarn run ts-compile-check
RUN yarn run build

RUN sed -i \
    -e 's/#2d4048/#202124/g' \
    -e 's/#25333d/#1e2023/g'  \
    -e 's/#fcfdfd/#f3f4f5/g' \
    -e 's/#f1f6f8/#e7e9eb/g' \
    -e 's/#e3eaed/#d3d6da/g' \
    -e 's/#cbd4d8/#b7bbc1/g' \
    -e 's/#aeb8bc/#989da3/g' \
    -e 's/#859399/#7b7f85/g' \
    -e 's/#6a7a81/#5b686e/g' \
    -e 's/#4f6169/#4f5256/g' \
    -e 's/#3a4d55/#3a3d41/g' \
    -e 's/#2d4048/#202124/g' \
    -e 's/#21333b/#383d44/g' \
    -e 's/#1b2b32/#2a2d2f/g' \
    $(grep -rl "#2d4048\|#25333d\|#fcfdfd\|#f1f6f8\|#e3eaed\|#cbd4d8\|#aeb8bc\|#859399\|#6a7a81\|#4f6169\|#3a4d55\|#2d4048\|#21333b\|#1b2b32")

FROM bitnami/nginx:1.25.2
COPY --from=build /app/build /app
